<head>
	
	<title>Horizontal CFB Scoreboard by Solrac8080</title>
	<link rel="icon" type="img/png" href="https://github.com/ionic-team/ionicons/raw/master/png/512/ios7-americanfootball.png">
	<link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js" type="text/javascript"></script>
	<link href="https://fonts.googleapis.com/css?family=Roboto:700" rel="stylesheet">
	
	<style>
	::-webkit-scrollbar { 
    display: none; 
	}
	body{
		background-color: #208040;
		color: white;
		font-family: 'Roboto', sans-serif;
		font-size: 12px;
		font-weight: bold;
	}
	p{
		margin-bottom: 12px;
		margin-top: 2px;
	}
	.floatingbox {
		border-radius: 5px;
		background-color: #004718;
		float: left;
		width:182px;
		height:56px;
		margin:2px;
		border:2px solid grey;
	}
	.split1 {
		float: left;
		width:140px;
		height:100%;
		margin-left:2px;
	}
	.split2 {
		float: right;
		width:38px;
		height:100%;
		text-align: center;
		margin-right:2px
	}
	.redzone {
		background-color: #AF402C;
	}

	</style>
	<script>
		var leng=0;
		var jsondata=[]
		var conf=[]
		var GET = {};
		var query = window.location.search.substring(1).split("&");
		for (var i = 0, max = query.length; i < max; i++){
			if (query[i] === ""){continue;}
			var param = query[i].split("=");
			GET[decodeURIComponent(param[0])] = decodeURIComponent(param[1] || "");
		}
		//console.log(GET)
		
		
		for(j=0;j<GET.conf.split(',').length;j++){
			switch (GET.conf.split(',')[j]){
				case 'all':
					conf.push('all-conf');
					break;
				case 'acc':
					conf.push('atlantic-coast');
					break;
				case 'b10':
					conf.push('big-ten');
					break;
				case 'b12':
					conf.push('big-12');
					break;
				case 'p12':
					conf.push('pac-12');
					break;
				case 'sec':
					conf.push('southeastern');
					break;
				case 't25':
					conf.push('top-25');
					break;
			}
		}
		
		function makedata(json) {
			var games=[];
			for(var i=0;i<json.scoreboard.length;i++){
				leng=leng+json.scoreboard[i].games.length;
				for(j=0;j<json.scoreboard[i].games.length;j++){
					games.push(json.scoreboard[i].games[j]);
				}
			}
			makehtml(games)
			
		}
		
		function updatedata(json) {
			var games=[];
			for(var i=0;i<json.scoreboard.length;i++){
				leng=leng+json.scoreboard[i].games.length;
				for(j=0;j<json.scoreboard[i].games.length;j++){
					games.push(json.scoreboard[i].games[j]);
				}
			}
			updatehtml(games)
			
		}

		function getweek(){
			week = moment().diff(moment("08232017", 'MMDDYYYY'), 'week').toString()
			if(week.length==1){
				week = "0"+week
			}
			console.log(week)
			return week
		}
		
		function make(){
			$.ajax({
				url: "http://data.ncaa.com/jsonp/scoreboard/football/fbs/2017/"+getweek()+"/scoreboard.html?callback=makedata",
				dataType: "jsonp"
			})
		}
		
		function update(){
			$.ajax({
				url: "http://data.ncaa.com/jsonp/scoreboard/football/fbs/2017/"+getweek()+"/scoreboard.html?callback=updatedata",
				dataType: "jsonp"
			})
		}
		
		
		
		
		
		function makehtml(data) {
				$('body').html('')
				console.log(conf)
				for(i=0;i<data.length;i++){
					if(data[i].conference.includes(conf[0])==false&&data[i].conference.includes(conf[1])==false){continue;}
					if (data[i].gameState=='cancelled'||data[i].gameState=='canceled'){continue;}
					var hrank = '';
					var arank = '';
					if (data[i].home.teamRank >0){hrank='('+data[i].home.teamRank+') '}
					if (data[i].away.teamRank >0){arank='('+data[i].away.teamRank+') '}
					var timeclock = data[i].timeclock;
					if(timeclock == ''){timeclock="<br>"}
					$('body').append('<div class="floatingbox '+data[i].id+'-box"><div class="split1"><p class="'+data[i].id+'-time">'+moment.unix(data[i].startTimeEpoch).fromNow()+'</p><div class="'+data[i].id+'-homename">'+hrank+data[i].home.nameRaw+'</div><div class="'+data[i].id+'-awayname">'+arank+data[i].away.nameRaw+'</div></div><div class="split2"><div class="'+data[i].id+'-period">'+data[i].gameState+'</div><div class="'+data[i].id+'-timeclock">'+timeclock+'</div><div class="'+data[i].id+'-home">'+data[i].home.currentScore+'</div><div class="'+data[i].id+'-away">'+data[i].away.currentScore+'</div></div></div>')
				}
		}
		
		function updatehtml(data) {
				for(k=0;k<data.length;k++){
					if(data[k].conference.includes(conf[0])==false&&data[k].conference.includes(conf[1])==false){continue;}
					if(data[k].gameState=='cancelled'||data[k].gameState=='canceled'){continue;}
					if(data[k].gameState=='pre'){
						$("."+data[k].id+"-time").html(moment.unix(data[k].startTimeEpoch).fromNow());
					}
					if(data[k].gameState=='live'){
						var down = data[k].status.down;
						if (down == 1){down=down+'st'}
						if (down == 2){down=down+'nd'}
						if (down == 3){down=down+'rd'}
						if (down == 4){down=down+'th'}
						if (data[k].alerts.redzone!=0){
							if($("."+data[k].id+"-box")["0"].classList[2]!="redzone"){
								$("."+data[k].id+"-box").toggleClass("redzone")
							}
						}
						if (data[k].alerts.redzone==0){
							if($("."+data[k].id+"-box")["0"].classList[2]=="redzone"){
								$("."+data[k].id+"-box").toggleClass("redzone")
							}
						}
						if(data[k].downToGo!=""){
						$("."+data[k].id+"-time").html(data[k].downToGo)
						} else {
							$("."+data[k].id+"-time").html('<br>')
						}
						$("."+data[k].id+"-timeclock").html(data[k].timeclock)
						$("."+data[k].id+"-period").html(data[k].currentPeriod)
						if(data[k].status.possession==data[k].home.nameRaw){
							if($("."+data[k].id+"-homename")["0"].classList[1]!="ion-ios-americanfootball"){
								$("."+data[k].id+"-homename").toggleClass("ion-ios-americanfootball")
							}
							if($("."+data[k].id+"-awayname")["0"].classList[1]=="ion-ios-americanfootball"){
								$("."+data[k].id+"-awayname").toggleClass("ion-ios-americanfootball")
							}
						}
						if(data[k].status.possession==data[k].away.nameRaw){
							if($("."+data[k].id+"-awayname")["0"].classList[1]!="ion-ios-americanfootball"){
								$("."+data[k].id+"-awayname").toggleClass("ion-ios-americanfootball")
							}
							if($("."+data[k].id+"-homename")["0"].classList[1]=="ion-ios-americanfootball"){
								$("."+data[k].id+"-homename").toggleClass("ion-ios-americanfootball")
							}
						}
					}
					if(data[k].gameState=='final'){
						if($("."+data[k].id+"-box")["0"].classList[2]=="redzone"){
							$("."+data[k].id+"-box").toggleClass("redzone")
						}
						$("."+data[k].id+"-period").html(data[k].gameState)
						$("."+data[k].id+"-homename").removeClass("ion-ios-americanfootball")
						$("."+data[k].id+"-awayname").removeClass("ion-ios-americanfootball")
						if(data[k].home.winner=="true"){
							if($("."+data[k].id+"-homename").hasClass("ion-trophy")==false){
								$("."+data[k].id+"-homename").toggleClass("ion-trophy")
								$("."+data[k].id+"-time").html(data[k].home.nameRaw+" Won")
							}
						}
						if(data[k].away.winner=="true"){
							if($("."+data[k].id+"-awayname").hasClass("ion-trophy")==false){
								$("."+data[k].id+"-awayname").toggleClass("ion-trophy")
								$("."+data[k].id+"-time").html(data[k].away.nameRaw+" Won")
							}
						}
					}
					$("."+data[k].id+"-home").html(data[k].home.currentScore);
					$("."+data[k].id+"-away").html(data[k].away.currentScore);
				}
		}
		setInterval(function(){
			update()
		}, 15000);
	</script>
	
</head>

<body onload='make()'>

</body>
